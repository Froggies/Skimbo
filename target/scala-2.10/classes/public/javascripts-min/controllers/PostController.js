define(["app"],function(e){e.controller("PostMessageController",["$scope","Network","$rootScope","PopupProvider",function(e,t,n,r){function i(){e.title="",e.message="",e.url="",e.image="",e.showErrorPosterRequired=!1,e.showErrorTitleRequired=!1,e.showErrorContentRequired=!1}e.$destroy=function(){var e=this.$parent;this.$broadcast("$destroy"),e.$$childHead==this&&(e.$$childHead=this.$$nextSibling),e.$$childTail==this&&(e.$$childTail=this.$$prevSibling),this.$$prevSibling&&(this.$$prevSibling.$$nextSibling=this.$$nextSibling),this.$$nextSibling&&(this.$$nextSibling.$$prevSibling=this.$$prevSibling),this.$id=null,this.$$phase=this.$parent=this.$$watchers=this.$$nextSibling=this.$$prevSibling=this.$$childHead=this.$$childTail=null,this["this"]=this.$root=null,this.$$asyncQueue=null,this.$$listeners=null},e.showPost=!1,e.showHelp=!1,i(),n.$on("allPosters",function(t,n){e.$apply(function(){e.providersWithTitle=[],e.providersWithUrl=[],e.providersWithImage=[],e.providers=n;for(var t=0;t<e.providers.length;t++){var r=e.providers[t];r.name=r.service,r.selected=!1,(r.service=="linkedin"||r.service=="github"||r.service=="scoopit"||r.service=="viadeo"||r.service=="googleplus")&&e.providersWithTitle.push(r),(r.service=="linkedin"||r.service=="facebook"||r.service=="scoopit"||r.service=="viadeo")&&e.providersWithUrl.push(r),(r.service=="linkedin"||r.service=="facebook"||r.service=="scoopit"||r.service=="viadeo"||r.service=="googleplus")&&e.providersWithImage.push(r),r.canHavePageId==1&&(r.arg={},r.arg.possibleValues=[])}console.log(e.providers)})}),n.$on("dispatchMsg",function(t,n){i(),e.show(),e.showPost=!0,e.title="",e.message=n.original,e.url=n.directLink,e.image=""}),e.show=function(){e.showPost=!e.showPost,e.showPost==1&&e.providers==undefined&&t.send({cmd:"allPosters"})},e.selectPoster=function(e){e.hasToken==1?e.selected=!e.selected:r.openPopup({name:e.tokenProvider},function(){e.selected=!e.selected,t.send({cmd:"allUnifiedRequests"}),t.send({cmd:"allPosters"})})},e.post=function(){var n=[];for(var r=0;r<e.providers.length;r++){var s=e.providers[r];s.selected==1&&(console.log(s),name=s.name||s.service,n.push({name:name,toPageId:s.toPageId}))}if(n.length==0)e.showErrorPosterRequired=!0;else if(e.title=="")e.showErrorPosterRequired=!1,e.showErrorTitleRequired=!0;else if(e.message=="")e.showErrorPosterRequired=!1,e.showErrorTitleRequired=!1,e.showErrorContentRequired=!0;else{var o={cmd:"post",body:{providers:n,post:{title:e.title,message:e.message,url:e.url,url_image:e.image}}};console.log(o),t.send(o),e.showPost=!1,i()}},e.selectOracle=function(e,t){e.toPageId=t.call,e.possibleValues=[]}}])})