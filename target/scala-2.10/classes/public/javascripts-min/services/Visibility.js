define(["app"],function(e){return e.factory("Visibility",function(){function i(){document.title="Skimbo",r=0,t=!0}function s(){t=!1,r=0}var e=function(e,t){function s(r){var i=document.body;r=r||window.event,r.type=="focus"||r.type=="focusin"?e():r.type=="blur"||r.type=="focusout"?t():i.className=this[n]?t():e()}var n,r,i={hidden:"visibilitychange",mozHidden:"mozvisibilitychange",webkitHidden:"webkitvisibilitychange",msHidden:"msvisibilitychange",oHidden:"ovisibilitychange"};for(n in i)if(i.hasOwnProperty(n)&&n in document){r=i[n];break}r?document.addEventListener(r,s):window.onfocus=window.onblur=s},t=!0;try{t=document.hasFocus()}catch(n){t=!0}var r=0;return e(i,s),{notifyNewMessage:function(){t||(r+=1,document.title="("+r+") Skimbo")},isPageVisible:function(){return t}}}),e})